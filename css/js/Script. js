// ======================
// 1. RULES CONFIGURATION (Edit this section only!)
// ======================
const formatRules = {
  // A. Manual Bans (Specific Cards)
  bannedCards: [
    "Sol Ring",
    "Mana Crypt",
    "Dockside Extortionist"
    // Add more as needed
  ],

  // B. Banned Card Types
  bannedTypes: [
    // "Planeswalker", // Uncomment to ban all planeswalkers
    // "Saga"         // Uncomment to ban all sagas
  ],

  // C. Mechanics Restrictions
  mechanics: {
    unconditionalKill: { minCmc: 5 },      // Kill spells must cost 5+ mana
    unconditionalCounter: { minCmc: 4 },   // Counterspells must cost 4+ mana
    damageSpells: { maxDamageToCmc: 1 },   // Damage <= CMC
    manaRocks: { minCmc: 3, mustEnterTapped: true },
    landDestruction: { minCmc: 4 }
  }
};

// ======================
// 2. CORE FUNCTIONALITY (Don't edit below unless adding new rules)
// ======================
const cardCache = {};
const searchButton = document.getElementById('search-button');
const cardSearch = document.getElementById('card-search');
const resultBox = document.getElementById('result');

// Initialize
document.addEventListener('DOMContentLoaded', function() {
  searchButton.addEventListener('click', checkLegality);
  cardSearch.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') checkLegality();
  });
  if (window.location.pathname.includes('playlist.html')) loadAllSets();
});

async function checkLegality() {
  const cardName = cardSearch.value.trim();
  if (!cardName) {
    resultBox.textContent = "Please enter a card name";
    resultBox.className = "result-box";
    return;
  }

  try {
    const card = await fetchCard(cardName);
    const isLegal = evaluateCard(card);
    resultBox.textContent = `${card.name} is ${isLegal ? 'LEGAL' : 'BANNED'}`;
    resultBox.className = `result-box ${isLegal ? 'legal' : 'banned'}`;
  } catch (error) {
    resultBox.textContent = "Card not found or error occurred";
    resultBox.className = "result-box";
  }
}

function evaluateCard(card) {
  // 1. Check against banned cards list
  if (formatRules.bannedCards.includes(card.name)) return false;

  // 2. Check against banned types
  if (formatRules.bannedTypes.some(type => card.type_line?.includes(type))) return false;

  // 3. Check mechanical restrictions
  if (isUnconditionalKillSpell(card) && card.cmc < formatRules.mechanics.unconditionalKill.minCmc) return false;
  if (isUnconditionalCounter(card) && card.cmc < formatRules.mechanics.unconditionalCounter.minCmc) return false;
  if (isDamageSpell(card) && getMaxDamage(card) > card.cmc * formatRules.mechanics.damageSpells.maxDamageToCmc) return false;
  if (isManaRock(card) && (card.cmc < formatRules.mechanics.manaRocks.minCmc || 
     (formatRules.mechanics.manaRocks.mustEnterTapped && !entersTapped(card)))) return false;
  if (isLandDestruction(card) && card.cmc < formatRules.mechanics.landDestruction.minCmc) return false;

  return true;
}

// ======================
// 3. HELPER FUNCTIONS (Add new ones here when adding rules)
// ======================
function isUnconditionalKillSpell(card) {
  return (/destroy target (creature|permanent)/i.test(card.oracle_text) ||
          /exile target (creature|permanent)/i.test(card.oracle_text)) &&
         !/(if|unless|when)/i.test(card.oracle_text);
}

function isUnconditionalCounter(card) {
  return /counter target (spell|ability)/i.test(card.oracle_text) &&
         !/(if|unless|when)/i.test(card.oracle_text);
}

function isDamageSpell(card) {
  return /deal(?:s)? \d+ damage/i.test(card.oracle_text);
}

function getMaxDamage(card) {
  const match = card.oracle_text.match(/deal(?:s)? (\d+) damage/i);
  return match ? parseInt(match[1]) : 0;
}

function isManaRock(card) {
  return card.type_line?.includes("Artifact") && 
         /add[s]? \{.+\}/i.test(card.oracle_text);
}

function entersTapped(card) {
  return /enters the battlefield tapped/i.test(card.oracle_text);
}

function isLandDestruction(card) {
  return /destroy target land|sacrifice a land/i.test(card.oracle_text);
}

// ======================
// 4. SET BROWSER FUNCTIONS (No changes needed here)
// ======================
// ... (keep all your existing set browser functions as-is) ...
