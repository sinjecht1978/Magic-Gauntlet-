<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magic Gauntlet Hub - Fixed</title>
    <style>
    /* ===== BASE STYLES ===== */
    body {
        font-family: 'Segoe UI', Arial, sans-serif;
        margin: 0;
        padding: 0;
        background: #f5f7fa;
        color: #333;
        line-height: 1.6;
    }
    
    /* ===== TAB SYSTEM ===== */
    .tab-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }
    
    .tab-buttons {
        display: flex;
        margin-bottom: -1px;
        flex-wrap: wrap;
    }
    
    .tab-btn {
        padding: 12px 20px;
        background: #e0e0e0;
        border: none;
        border-radius: 5px 5px 0 0;
        cursor: pointer;
        margin-right: 5px;
        font-weight: bold;
        transition: all 0.3s;
    }
    
    .tab-btn.active {
        background: #3498db;
        color: white;
    }
    
    .tab-content {
        display: none;
        padding: 20px;
        background: white;
        border-radius: 0 5px 5px 5px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .tab-content.active {
        display: block;
    }
    
    /* ===== CARD CHECKER STYLES ===== */
    #checker-container {
        padding: 30px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        text-align: center;
    }
    
    #searchInput {
        width: 70%;
        padding: 12px 15px;
        border: 2px solid #ddd;
        border-radius: 6px;
        font-size: 1rem;
        transition: border 0.3s;
    }
    
    #searchInput:focus {
        border-color: #3498db;
        outline: none;
    }
    
    #checker-container button {
        background: #3498db;
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 6px;
        font-size: 1rem;
        cursor: pointer;
        transition: background 0.3s;
        margin: 5px;
    }
    
    #checker-container button:hover {
        background: #2980b9;
    }
    
    #result {
        margin-top: 25px;
        padding: 15px;
        font-size: 1.2rem;
        font-weight: bold;
        border-radius: 6px;
        transition: all 0.3s;
    }
    
    .banned {
        background: #e74c3c;
        color: white;
        box-shadow: 0 3px 6px rgba(231, 76, 60, 0.2);
    }
    
    .legal {
        background: #2ecc71;
        color: white;
        box-shadow: 0 3px 6px rgba(46, 204, 113, 0.2);
    }
    
    .card-image {
        max-width: 100%;
        height: auto;
        border-radius: 5px;
        margin-top: 10px;
    }
    
    .card-info {
        text-align: left;
        margin-top: 10px;
    }
    
    /* ===== GRAVEYARD STYLES ===== */
    .banned-card {
        background: #f8d7da;
        padding: 15px;
        margin-bottom: 10px;
        border-radius: 5px;
        border-left: 4px solid #dc3545;
    }
    
    /* ===== PLAYLIST STYLES ===== */
    .set-selector {
        margin-bottom: 20px;
    }
    
    #setSelect {
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #ddd;
        font-size: 1rem;
        width: 300px;
    }
    
    .card-gallery {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }
    
    .card-item {
        background: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        transition: transform 0.3s;
    }
    
    .card-item:hover {
        transform: translateY(-5px);
    }
    
    .card-item img {
        width: 100%;
        height: auto;
    }
    
    .card-item-content {
        padding: 15px;
    }
    
    .card-item h3 {
        margin: 0 0 10px 0;
        font-size: 1rem;
    }
    
    .card-status {
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 0.8rem;
        display: inline-block;
    }
    
    .status-banned {
        background: #e74c3c;
        color: white;
    }
    
    .status-legal {
        background: #2ecc71;
        color: white;
    }
    
    .card-rules-text {
        font-size: 0.9rem;
        color: #666;
        margin-top: 10px;
    }
    
    .set-not-legal {
        background: #ff9800;
        color: white;
    }
    
    /* ===== EXAMPLES SECTION ===== */
    .examples {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-top: 30px;
    }
    
    .example-card {
        flex: 1;
        min-width: 300px;
        background: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
    
    .example-card h3 {
        border-bottom: 2px solid #3498db;
        padding-bottom: 10px;
        margin-top: 0;
    }
    
    /* ===== LEGAL SETS STYLES ===== */
    .legal-sets-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 10px;
        margin-top: 15px;
    }
    
    .legal-set-item {
        background: #f0f8ff;
        padding: 10px;
        border-radius: 5px;
        border-left: 3px solid #3498db;
    }
    
    /* ===== BANNED MANAGEMENT STYLES ===== */
    .banned-management {
        margin-top: 20px;
    }
    
    .password-prompt {
        margin-bottom: 20px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 5px;
        border-left: 4px solid #3498db;
    }
    
    .password-prompt input {
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px;
        margin-right: 10px;
    }
    
    .password-prompt button {
        background: #3498db;
        color: white;
        border: none;
        padding: 8px 15px;
        border-radius: 4px;
        cursor: pointer;
    }
    
    .add-banned-form {
        display: flex;
        margin-bottom: 20px;
        gap: 10px;
    }
    
    .add-banned-form input {
        flex: 1;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    
    .add-banned-form button {
        background: #e74c3c;
        color: white;
        border: none;
        padding: 10px 15px;
        border-radius: 4px;
        cursor: pointer;
    }
    
    .banned-list-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        background: #f8d7da;
        margin-bottom: 8px;
        border-radius: 4px;
        border-left: 4px solid #dc3545;
    }
    
    .remove-btn {
        background: #dc3545;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 3px;
        cursor: pointer;
    }
    
    .ban-type-section {
        margin-top: 30px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 5px;
    }
    
    .ban-type-checkbox {
        margin-right: 8px;
    }
    
    .ban-type-item {
        margin-bottom: 10px;
        padding: 10px;
        background: white;
        border-radius: 4px;
        border-left: 3px solid #ff9800;
    }
    
    @media (max-width: 768px) {
        .card-gallery {
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        }
        
        .examples {
            flex-direction: column;
        }
        
        .legal-sets-grid {
            grid-template-columns: 1fr;
        }
        
        .add-banned-form {
            flex-direction: column;
        }
    }
    
    @media (max-width: 600px) {
        .tab-btn {
            padding: 8px 12px;
            font-size: 0.9rem;
        }
        
        #searchInput {
            width: 100%;
        }
        
        #checker-container button {
            width: 100%;
        }
        
        .card-gallery {
            grid-template-columns: 1fr;
        }
        
        #setSelect {
            width: 100%;
        }
    }
    </style>
</head>
<body>
    <div class="tab-container">
        <div class="tab-buttons">
            <button class="tab-btn active" onclick="openTab(event, 'checker')">Card Checker</button>
            <button class="tab-btn" onclick="openTab(event, 'guidelines')">Guidelines</button>
            <button class="tab-btn" onclick="openTab(event, 'playlist')">Playlist</button>
            <button class="tab-btn" onclick="openTab(event, 'graveyard')">Graveyard</button>
            <button class="tab-btn" onclick="openTab(event, 'banned-management')">Manage Banned</button>
        </div>
        
        <!-- Card Checker Tab -->
        <div id="checker" class="tab-content active">
            <h1>Magic Gauntlet Card Checker</h1>
            <div id="checker-container">
                <input type="text" id="searchInput" placeholder="Enter card name (e.g., Reprisal, Murder, Doom Blade)">
                <button onclick="checkCard()">Check Card</button>
                <div id="result"></div>
                <div id="card-display" style="display:none;">
                    <img id="card-image" class="card-image" src="" alt="Card Image">
                    <div id="card-info" class="card-info"></div>
                </div>
            </div>
        </div>
        
        <!-- Guidelines Tab -->
        <div id="guidelines" class="tab-content">
            <h1>Format Guidelines</h1>
            <div class="guidelines-container">
                <h2>Core Rules</h2>
                <ul>
                    <li><strong>Damage Spells:</strong> Can't deal more damage than their CMC</li>
                    <li><strong>Kill Spells:</strong> Unconditional removal must cost 5+ mana</li>
                    <li><strong>Conditional Removal:</strong> Spells with restrictions are legal at lower costs</li>
                    <li><strong>Counterspells:</strong> Unconditional counters must cost 4+ mana</li>
                    <li><strong>Board Wipes:</strong> Must cost 6+ mana</li>
                    <li><strong>Land Destruction:</strong> Must cost 4+ mana</li>
                    <li><strong>Mana Rocks:</strong> Under 3 CMC must enter tapped, can only produce 1 mana</li>
                    <li><strong>Set Restrictions:</strong> Only cards from approved sets are legal</li>
                </ul>
                
                <h2>Hard Banned Cards</h2>
                <div id="banned-list"></div>
                
                <h2>Banned Card Types</h2>
                <div id="banned-types-list"></div>
                
                <h2>Legal Sets</h2>
                <div id="legal-sets-list" class="legal-sets"></div>
            </div>
        </div>
        
        <!-- Playlist Tab -->
        <div id="playlist" class="tab-content">
            <h1>Set Explorer</h1>
            <p>Browse cards from legal Magic: The Gathering sets to see which are playable in the Magic Gauntlet format.</p>
            
            <div class="set-selector">
                <label for="setSelect">Select a Set:</label>
                <select id="setSelect" onchange="loadSetCards()">
                    <option value="">-- Choose a Set --</option>
                </select>
            </div>
            
            <div id="set-info"></div>
            <div id="set-cards" class="card-gallery"></div>
        </div>
        
        <!-- Graveyard Tab -->
        <div id="graveyard" class="tab-content">
            <h1>Graveyard (Banned Cards)</h1>
            <div id="graveyard-cards" class="card-gallery"></div>
        </div>
        
        <!-- Banned Management Tab -->
        <div id="banned-management" class="tab-content">
            <h1>Manage Banned Cards</h1>
            
            <div id="password-section" class="password-prompt">
                <h3>Admin Access Required</h3>
                <input type="password" id="adminPassword" placeholder="Enter admin password">
                <button onclick="checkPassword()">Authenticate</button>
            </div>
            
            <div id="banned-management-content" style="display: none;">
                <p>Add or remove cards from the hard banned list. Changes will be reflected across all sections.</p>
                
                <div class="banned-management">
                    <div class="add-banned-form">
                        <input type="text" id="newBannedCard" placeholder="Enter card name to ban">
                        <button onclick="addToBannedList()">Add to Banned List</button>
                    </div>
                    
                    <div id="banned-management-list"></div>
                    
                    <div class="ban-type-section">
                        <h3>Ban Entire Card Types</h3>
                        <p>Check the box to ban all cards of these types:</p>
                        <div class="ban-type-item">
                            <input type="checkbox" id="ban-planeswalkers" class="ban-type-checkbox" onchange="toggleCardTypeBan('Planeswalker', this.checked)">
                            <label for="ban-planeswalkers">Ban all Planeswalker cards</label>
                        </div>
                        <div class="ban-type-item">
                            <input type="checkbox" id="ban-schemes" class="ban-type-checkbox" onchange="toggleCardTypeBan('Scheme', this.checked)">
                            <label for="ban-schemes">Ban all Scheme cards</label>
                        </div>
                        <div class="ban-type-item">
                            <input type="checkbox" id="ban-conspiracies" class="ban-type-checkbox" onchange="toggleCardTypeBan('Conspiracy', this.checked)">
                            <label for="ban-conspiracies">Ban all Conspiracy cards</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ADMIN PASSWORD - Change this to your desired password
        const ADMIN_PASSWORD = "admin123";
        
        // SINGLE SOURCE OF TRUTH FOR BANNED CARDS - Load from localStorage or use default
        let hardBannedCards = JSON.parse(localStorage.getItem('hardBannedCards')) || [
            "Sol Ring", "Lightning Bolt", "Mana Crypt", "Mox Emerald", 
            "Mox Jet", "Mox Pearl", "Mox Ruby", "Mox Sapphire", 
            "Murder", "Hero's Downfall", "Angel of Sanctions"
        ];
        
        // Banned card types
        let bannedCardTypes = JSON.parse(localStorage.getItem('bannedCardTypes')) || [];

        // Save to localStorage whenever the list changes
        function saveBannedCards() {
            localStorage.setItem('hardBannedCards', JSON.stringify(hardBannedCards));
            localStorage.setItem('bannedCardTypes', JSON.stringify(bannedCardTypes));
        }

        // LEGAL SETS
        const legalSets = [
            "Adventures in the Forgotten Realms", "Aether Revolt", "Aetherdrift", "Alara Reborn", 
            "Alliances", "Amonkhet", "Antiquities", "Apocalypse", "Arabian Nights", 
            "Assassin's Creed", "Avacyn Restored", "Battle for Zendikar","Beta",
            "Betrayers of Kamigawa", "Bloomburrow", "Born of the Gods", "Champions of Kamigawa", 
            "Coldsnap", "Conflux", "Core Set 2019", "Core Set 2020", "Core Set 2021", 
            "Dark Ascension", "Darksteel", "Dominaria", "Dominaria: United", 
            "Dragons of Tarkir", "Dragon's Maze", "Duskmourn: House of Horror", "Edge of Eternities", 
            "Eldritch Moon", "Eventide", "Exodus", "Fallen Empires", "Fate Reforged", 
            "Final Fantasy", "Fifth Dawn", "Future Sight", "Gatecrash", "Guilds of Ravnica", 
            "Homelands", "Hour of Devastation", "Ice Age", "Ikoria: Lair of Behemoths", 
            "Innistrad", "Innistrad: Crimson Vow", "Innistrad: Midnight Hunt", "Invasion", 
            "Ixalan", "Judgment", "Journey into Nyx", "Kaladesh", "Kaldheim", 
            "Kamigawa: Neon Dynasty", "Khans of Tarkir", "Legends", "Legions", 
            "Limited Edition Beta", "Lorwyn", "Magic 2010", "Magic 2011", "Magic 2012", 
            "Magic 2013", "Magic 2014", "Magic 2015", "Magic Origins", "March of the Machine", 
            "March of the Machine: The Aftermath", "Mercadian Masques", "Mirage", 
            "Mirrodin", "Mirrodin Besieged", "Morningtide", "MTG Lord of the Rings", 
            "Murders at Karlov Manor", "Nemesis", "New Phyrexia", "Oath of the Gatewatch", 
            "Odyssey", "Onslaught", "Outlaws of Thunder Junction", "Phyrexia: All Will Be One", 
            "Planechase", "Planar Chaos", "Planeshift", "Prophecy", "Ravnica Allegiance", 
            "Ravnica: City of Guilds", "Return to Ravnica", "Rise of the Eldrazi", 
            "Rivals of Ixalan", "Saviors of Kamigawa", "Scars of Mirrodin", "Scourge", 
            "Shadows over Innistrad", "Shadowmoor", "Shards of Alara", "Streets of New Capenna", 
            "Strixhaven: School of Mages", "Stronghold", "Tarkir: Dragonstorm", "Tempest", 
            "The Brothers' War", "The Dark", "The Lost Caverns of Ixalan", "Theros", 
            "Theros Beyond Death", "Throne of Eldraine", "Time Spiral", "Torment", 
            "Urza's Destiny", "Urza's Legacy", "Urza's Saga", "Visions", 
            "War of the Spark", "Weatherlight", "Wilds of Eldraine", "Worldwake", 
            "Zendikar", "Zendikar Rising"
        ];

        // TAB SYSTEM
        function openTab(event, tabName) {
            // Hide all tab contents
            const tabContents = document.getElementsByClassName("tab-content");
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove("active");
            }
            
            // Deactivate all tab buttons
            const tabButtons = document.getElementsByClassName("tab-btn");
            for (let i = 0; i < tabButtons.length; i++) {
                tabButtons[i].classList.remove("active");
            }
            
            // Activate selected tab
            document.getElementById(tabName).classList.add("active");
            event.currentTarget.classList.add("active");
            
            // If playlist tab is opened, populate set selector
            if (tabName === 'playlist') {
                populateSetSelector();
            }
            
            // If banned management tab is opened, check if already authenticated
            if (tabName === 'banned-management') {
                const isAuthenticated = sessionStorage.getItem('adminAuthenticated') === 'true';
                if (isAuthenticated) {
                    document.getElementById('password-section').style.display = 'none';
                    document.getElementById('banned-management-content').style.display = 'block';
                    updateBannedManagementList();
                    updateBanTypeCheckboxes();
                } else {
                    document.getElementById('password-section').style.display = 'block';
                    document.getElementById('banned-management-content').style.display = 'none';
                }
            }
        }

        // CHECK ADMIN PASSWORD
        function checkPassword() {
            const passwordInput = document.getElementById('adminPassword');
            if (passwordInput.value === ADMIN_PASSWORD) {
                sessionStorage.setItem('adminAuthenticated', 'true');
                document.getElementById('password-section').style.display = 'none';
                document.getElementById('banned-management-content').style.display = 'block';
                updateBannedManagementList();
                updateBanTypeCheckboxes();
            } else {
                alert('Incorrect password. Access denied.');
                passwordInput.value = '';
            }
        }
        
        // UPDATE BAN TYPE CHECKBOXES
        function updateBanTypeCheckboxes() {
            document.getElementById('ban-planeswalkers').checked = bannedCardTypes.includes('Planeswalker');
            document.getElementById('ban-schemes').checked = bannedCardTypes.includes('Scheme');
            document.getElementById('ban-conspiracies').checked = bannedCardTypes.includes('Conspiracy');
        }
        
        // TOGGLE CARD TYPE BAN
        function toggleCardTypeBan(cardType, isBanned) {
            if (isBanned) {
                if (!bannedCardTypes.includes(cardType)) {
                    bannedCardTypes.push(cardType);
                }
            } else {
                bannedCardTypes = bannedCardTypes.filter(type => type !== cardType);
            }
            saveBannedCards();
        }

        // POPULATE SET SELECTOR
        function populateSetSelector() {
            const setSelect = document.getElementById("setSelect");
            // Clear existing options except the first one
            while (setSelect.options.length > 1) {
                setSelect.remove(1);
            }
            
            // Add legal sets to the dropdown
            legalSets.forEach(set => {
                const option = document.createElement("option");
                option.value = set;
                option.textContent = set;
                setSelect.appendChild(option);
            });
        }

        // LOAD CARDS FOR SELECTED SET
        async function loadSetCards() {
            const setName = document.getElementById("setSelect").value;
            if (!setName) return;
            
            const setInfo = document.getElementById("set-info");
            const setCards = document.getElementById("set-cards");
            
            setInfo.innerHTML = "<p>Loading cards...</p>";
            setCards.innerHTML = "";
            
            try {
                // Handle Limited Edition Beta specially
                let apiSetName = setName;
                if (setName === "Limited Edition Beta") {
                    apiSetName = "leb"; // Scryfall uses "leb" for Limited Edition Beta
                }
                
                // We need to use the Scryfall API to search for cards in the set
                const response = await fetch(`https://api.scryfall.com/cards/search?q=e:${encodeURIComponent(apiSetName.toLowerCase().replace(/[^a-z0-9]+/g, ''))}+order:set`);
                const data = await response.json();
                
                setInfo.innerHTML = `<h2>${setName} (${data.data.length} cards)</h2>`;
                
                // Display cards
                data.data.forEach(card => {
                    const isBanned = isCardBanned(card);
                    const status = isBanned ? "banned" : "legal";
                    
                    const cardElement = document.createElement("div");
                    cardElement.className = "card-item";
                    cardElement.innerHTML = `
                        <img src="${card.image_uris ? card.image_uris.normal : (card.card_faces ? card.card_faces[0].image_uris.normal : '')}" alt="${card.name}">
                        <div class="card-item-content">
                            <h3>${card.name}</h3>
                            <span class="card-status status-${status}">${status.toUpperCase()}</span>
                        </div>
                    `;
                    
                    setCards.appendChild(cardElement);
                });
            } catch (error) {
                setInfo.innerHTML = `<p>Error loading set: ${error.message}. Note: Some custom sets may not be available in the API.</p>`;
                console.error("Error loading set:", error);
            }
        }

        // UPDATE GRAVEYARD DISPLAY
        function updateGraveyardDisplay() {
            const graveyard = document.getElementById("graveyard-cards");
            graveyard.innerHTML = hardBannedCards.map(card => `
                <div class="banned-card">
                    <h3>${card}</h3>
                </div>
            `).join("");
        }

        // UPDATE BANNED LIST IN GUIDELINES
        function updateBannedList() {
            const bannedList = document.getElementById("banned-list");
            bannedList.innerHTML = "<p>" + hardBannedCards.map(card => `"${card}"`).join(", ") + "</p>";
            
            const bannedTypesList = document.getElementById("banned-types-list");
            if (bannedCardTypes.length > 0) {
                bannedTypesList.innerHTML = "<p>" + bannedCardTypes.map(type => `All ${type} cards`).join(", ") + "</p>";
            } else {
                bannedTypesList.innerHTML = "<p>No card types are currently banned.</p>";
            }
        }
        
        // UPDATE BANNED MANAGEMENT LIST
        function updateBannedManagementList() {
            const bannedManagementList = document.getElementById("banned-management-list");
            bannedManagementList.innerHTML = hardBannedCards.map(card => `
                <div class="banned-list-item">
                    <span>${card}</span>
                    <button class="remove-btn" onclick="removeFromBannedList('${card.replace(/'/g, "\\'")}')">Remove</button>
                </div>
            `).join("");
        }
        
        // UPDATE LEGAL SETS LIST IN GUIDELINES
        function updateLegalSetsList() {
            const legalSetsList = document.getElementById("legal-sets-list");
            legalSetsList.innerHTML = `<p><strong>${legalSets.length} Legal Sets:</strong></p>
                <div class="legal-sets-grid">
                    ${legalSets.map(set => `<div class="legal-set-item">${set}</div>`).join("")}
                </div>`;
        }

        // ADD TO BANNED LIST
        function addToBannedList() {
            const newCardInput = document.getElementById("newBannedCard");
            const newCard = newCardInput.value.trim();
            
            if (!newCard) {
                alert("Please enter a card name");
                return;
            }
            
            if (hardBannedCards.includes(newCard)) {
                alert("This card is already banned");
                return;
            }
            
            hardBannedCards.push(newCard);
            saveBannedCards();
            updateBannedList();
            updateGraveyardDisplay();
            updateBannedManagementList();
            
            newCardInput.value = "";
            
            // If we're on the playlist tab and cards are loaded, refresh them
            if (document.getElementById("playlist").classList.contains("active") && 
                document.getElementById("setSelect").value) {
                loadSetCards();
            }
        }
        
        // REMOVE FROM BANNED LIST
        function removeFromBannedList(cardName) {
            hardBannedCards = hardBannedCards.filter(card => card !== cardName);
            saveBannedCards();
            updateBannedList();
            updateGraveyardDisplay();
            updateBannedManagementList();
            
            // If we're on the playlist tab and cards are loaded, refresh them
            if (document.getElementById("playlist").classList.contains("active") && 
                document.getElementById("setSelect").value) {
                loadSetCards();
            }
        }

        // CHECK IF CARD IS BANNED
        function isCardBanned(card) {
            // Check hard ban list first
            if (hardBannedCards.includes(card.name)) {
                return true;
            }
            
            // Check banned card types
            for (const bannedType of bannedCardTypes) {
                if (card.type_line && card.type_line.includes(bannedType)) {
                    return true;
                }
            }
            
            // Check if card is from a legal set
            let cardSetName = card.set_name;
            if (cardSetName === "Limited Edition Beta") {
                cardSetName = "Limited Edition Beta";
            }
            
            if (cardSetName && !legalSets.includes(cardSetName)) {
                return true;
            }

            // Special case for Abu Ja'far
            if (card.name === "Abu Ja'far") {
                return false;
            }

            // Damage spell rules
            if (card.type_line.includes("Instant") || card.type_line.includes("Sorcery")) {
                if (card.oracle_text && card.oracle_text.toLowerCase().includes("damage")) {
                    const damageMatch = card.oracle_text.match(/deal[s]? (\d+) damage/i);
                    if (damageMatch) {
                        const damage = parseInt(damageMatch[1]);
                        const cmc = card.cmc;
                        if (damage > cmc) {
                            return true;
                        }
                    }
                }
                
                // Improved kill spell rules - now properly handles conditional removal
                if (card.oracle_text && card.oracle_text.toLowerCase().includes("destroy target")) {
                    // Check if it's conditional removal
                    const isConditional = (
                        card.oracle_text.toLowerCase().includes("with") ||
                        card.oracle_text.toLowerCase().includes("unless") ||
                        card.oracle_text.toLowerCase().includes("if") ||
                        card.oracle_text.toLowerCase().includes("non") ||
                        card.oracle_text.toLowerCase().includes("can't") ||
                        card.oracle_text.toLowerCase().includes("without") ||
                        card.oracle_text.toLowerCase().includes("equal") ||
                        card.oracle_text.toLowerCase().includes("less") ||
                        card.oracle_text.toLowerCase().includes("greater")
                    );
                    
                    // Unconditional removal must cost 5 or more
                    if (!isConditional && card.cmc < 5) {
                        return true;
                    }
                }
                
                // Counter spell rules
                if (card.oracle_text && card.oracle_text.toLowerCase().includes("counter target")) {
                    // Check if it's conditional
                    const isConditional = (
                        card.oracle_text.toLowerCase().includes("unless") ||
                        card.oracle_text.toLowerCase().includes("if") ||
                        card.oracle_text.toLowerCase().includes("unless its controller pays") ||
                        card.oracle_text.toLowerCase().includes("that targets a")
                    );
                    
                    // Unconditional counters must cost 4 or more
                    if (!isConditional && card.cmc < 4) {
                        return true;
                    }
                }
            }
            
            // Board wipe rules
            if (card.oracle_text && (card.oracle_text.toLowerCase().includes("destroy all") || 
                card.oracle_text.toLowerCase().includes("exile all")) &&
                card.cmc < 6) {
                return true;
            }
            
            // Land destruction rules
            if (card.oracle_text && card.oracle_text.toLowerCase().includes("destroy target land") && 
                card.cmc < 4) {
                return true;
            }
            
            // Land rules
            if (card.type_line.includes("Land")) {
                if (card.oracle_text && (card.oracle_text.toLowerCase().includes("enters the battlefield untapped") ||
                    card.oracle_text.toLowerCase().includes("add two or more mana"))) {
                    return true;
                }
            }
            
            // Mana rock rules
            if (card.type_line.includes("Artifact")) {
                const oracleText = card.oracle_text ? card.oracle_text.toLowerCase() : "";
                
                if (oracleText.includes("add") && oracleText.includes("mana")) {
                    if (oracleText.match(/adds? \{.+\}.+and.+{.+}/) || 
                        oracleText.includes("two or more") ||
                        oracleText.includes("add an additional") ||
                        oracleText.match(/adds? \w+ mana/)) {
                        return true;
                    }
                    
                    if (card.cmc < 3 && 
                        !oracleText.includes("enters the battlefield tapped") &&
                        !card.name.toLowerCase().includes("lotus")) {
                        return true;
                    }
                }
            }
            
            return false;
        }

        async function checkCard() {
            const input = document.getElementById("searchInput").value.trim();
            const resultDiv = document.getElementById("result");
            const cardDisplay = document.getElementById("card-display");
            const cardImage = document.getElementById("card-image");
            const cardInfo = document.getElementById("card-info");
            
            if (!input) {
                resultDiv.textContent = "Please enter a card name";
                resultDiv.className = "";
                cardDisplay.style.display = "none";
                return;
            }

            try {
                const response = await fetch(`https://api.scryfall.com/cards/named?fuzzy=${encodeURIComponent(input)}`);
                const card = await response.json();
                
                cardImage.src = card.image_uris ? card.image_uris.normal : card.card_faces[0].image_uris.normal;
                cardInfo.innerHTML = `
                    <strong>${card.name}</strong><br>
                    <em>${card.type_line}</em><br>
                    <strong>Mana Cost:</strong> ${card.mana_cost} (CMC: ${card.cmc})<br>
                    <strong>Set:</strong> ${card.set_name}
                `;
                cardDisplay.style.display = "block";
                
                const isBanned = isCardBanned(card);
                if (isBanned) {
                    resultDiv.textContent = "BANNED";
                    resultDiv.className = "banned";
                } else {
                    resultDiv.textContent = "LEGAL";
                    resultDiv.className = "legal";
                }
            } catch (error) {
                resultDiv.textContent = "Card not found or error occurred";
                resultDiv.className = "";
                cardDisplay.style.display = "none";
                console.error("Error fetching card:", error);
            }
        }

        // INITIALIZE ON LOAD
        window.onload = function() {
            updateBannedList();
            updateGraveyardDisplay();
            updateLegalSetsList();
            populateSetSelector();
            
            // Enable Enter key in search
            document.getElementById("searchInput").addEventListener("keypress", function(event) {
                if (event.key === "Enter") {
                    checkCard();
                }
            });
            
            // Enable Enter key in banned card input
            document.getElementById("newBannedCard")?.addEventListener("keypress", function(event) {
                if (event.key === "Enter") {
                    addToBannedList();
                }
            });
            
            // Enable Enter key in password input
            document.getElementById("adminPassword")?.addEventListener("keypress", function(event) {
                if (event.key === "Enter") {
                    checkPassword();
                }
            });
        };
    </script>
</body>
        </html>
