<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magic Gauntlet Hub - Fixed</title>
    <style>
    /* ===== BASE STYLES ===== */
    body {
        font-family: 'Segoe UI', Arial, sans-serif;
        margin: 0;
        padding: 0;
        background: #f5f7fa;
        color: #333;
        line-height: 1.6;
    }
    
    /* ===== TAB SYSTEM ===== */
    .tab-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
    }
    
    .tab-buttons {
        display: flex;
        margin-bottom: -1px;
        flex-wrap: wrap;
    }
    
    .tab-btn {
        padding: 12px 20px;
        background: #e0e0e0;
        border: none;
        border-radius: 5px 5px 0 0;
        cursor: pointer;
        margin-right: 5px;
        font-weight: bold;
        transition: all 0.3s;
    }
    
    .tab-btn.active {
        background: #3498db;
        color: white;
    }
    
    .tab-content {
        display: none;
        padding: 20px;
        background: white;
        border-radius: 0 5px 5px 5px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .tab-content.active {
        display: block;
    }
    
    /* ===== CARD CHECKER STYLES ===== */
    #checker-container {
        padding: 30px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        text-align: center;
    }
    
    #searchInput {
        width: 70%;
        padding: 12px 15px;
        border: 2px solid #ddd;
        border-radius: 6px;
        font-size: 1rem;
        transition: border 0.3s;
    }
    
    #searchInput:focus {
        border-color: #3498db;
        outline: none;
    }
    
    #checker-container button {
        background: #3498db;
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 6px;
        font-size: 1rem;
        cursor: pointer;
        transition: background 0.3s;
        margin: 5px;
    }
    
    #checker-container button:hover {
        background: #2980b9;
    }
    
    #result {
        margin-top: 25px;
        padding: 15px;
        font-size: 1.2rem;
        font-weight: bold;
        border-radius: 6px;
        transition: all 0.3s;
    }
    
    .banned {
        background: #e74c3c;
        color: white;
        box-shadow: 0 3px 6px rgba(231, 76, 60, 0.2);
    }
    
    .legal {
        background: #2ecc71;
        color: white;
        box-shadow: 0 3px 6px rgba(46, 204, 113, 0.2);
    }
    
    .card-image {
        max-width: 100%;
        height: auto;
        border-radius: 5px;
        margin-top: 10px;
    }
    
    .card-info {
        text-align: left;
        margin-top: 10px;
    }
    
    /* ===== GRAVEYARD STYLES ===== */
    .banned-card {
        background: #f8d7da;
        padding: 15px;
        margin-bottom: 10px;
        border-radius: 5px;
        border-left: 4px solid #dc3545;
    }
    
    /* ===== PLAYLIST STYLES ===== */
    .set-selector {
        margin-bottom: 20px;
    }
    
    #setSelect {
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #ddd;
        font-size: 1rem;
        width: 300px;
    }
    
    .card-gallery {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }
    
    .card-item {
        background: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        transition: transform 0.3s;
    }
    
    .card-item:hover {
        transform: translateY(-5px);
    }
    
    .card-item img {
        width: 100%;
        height: auto;
    }
    
    .card-item-content {
        padding: 15px;
    }
    
    .card-item h3 {
        margin: 0 0 10px 0;
        font-size: 1rem;
    }
    
    .card-status {
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 0.8rem;
        display: inline-block;
    }
    
    .status-banned {
        background: #e74c3c;
        color: white;
    }
    
    .status-legal {
        background: #2ecc71;
        color: white;
    }
    
    .card-rules-text {
        font-size: 0.9rem;
        color: #666;
        margin-top: 10px;
    }
    
    .set-not-legal {
        background: #ff9800;
        color: white;
    }
    
    /* ===== EXAMPLES SECTION ===== */
    .examples {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        margin-top: 30px;
    }
    
    .example-card {
        flex: 1;
        min-width: 300px;
        background: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
    
    .example-card h3 {
        border-bottom: 2px solid #3498db;
        padding-bottom: 10px;
        margin-top: 0;
    }
    
    /* ===== LEGAL SETS STYLES ===== */
    .legal-sets-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 10px;
        margin-top: 15px;
    }
    
    .legal-set-item {
        background: #f0f8ff;
        padding: 10px;
        border-radius: 5px;
        border-left: 3px solid #3498db;
    }
    
    @media (max-width: 768px) {
        .card-gallery {
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        }
        
        .examples {
            flex-direction: column;
        }
        
        .legal-sets-grid {
            grid-template-columns: 1fr;
        }
    }
    
    @media (max-width: 600px) {
        .tab-btn {
            padding: 8px 12px;
            font-size: 0.9rem;
        }
        
        #searchInput {
            width: 100%;
        }
        
        #checker-container button {
            width: 100%;
        }
        
        .card-gallery {
            grid-template-columns: 1fr;
        }
        
        #setSelect {
            width: 100%;
        }
    }
    </style>
</head>
<body>
    <div class="tab-container">
        <div class="tab-buttons">
            <button class="tab-btn active" onclick="openTab(event, 'checker')">Card Checker</button>
            <button class="tab-btn" onclick="openTab(event, 'guidelines')">Guidelines</button>
            <button class="tab-btn" onclick="openTab(event, 'playlist')">Playlist</button>
            <button class="tab-btn" onclick="openTab(event, 'graveyard')">Graveyard</button>
        </div>
        
        <!-- Card Checker Tab -->
        <div id="checker" class="tab-content active">
            <h1>Magic Gauntlet Card Checker</h1>
            <div id="checker-container">
                <input type="text" id="searchInput" placeholder="Enter card name (e.g., Reprisal, Murder, Doom Blade)">
                <button onclick="checkCard()">Check Card</button>
                <div id="result"></div>
                <div id="card-display" style="display:none;">
                    <img id="card-image" class="card-image" src="" alt="Card Image">
                    <div id="card-info" class="card-info"></div>
                </div>
            </div>
        </div>
        
        <!-- Guidelines Tab -->
        <div id="guidelines" class="tab-content">
            <h1>Format Guidelines</h1>
            <div class="guidelines-container">
                <h2>Core Rules</h2>
                <ul>
                    <li><strong>Damage Spells:</strong> Can't deal more damage than their CMC</li>
                    <li><strong>Kill Spells:</strong> Unconditional removal must cost 5+ mana</li>
                    <li><strong>Conditional Removal:</strong> Spells with restrictions are legal at lower costs</li>
                    <li><strong>Counterspells:</strong> Unconditional counters must cost 4+ mana</li>
                    <li><strong>Board Wipes:</strong> Must cost 6+ mana</li>
                    <li><strong>Land Destruction:</strong> Must cost 4+ mana</li>
                    <li><strong>Mana Rocks:</strong> Under 3 CMC must enter tapped, can only produce 1 mana</li>
                    <li><strong>Set Restrictions:</strong> Only cards from approved sets are legal</li>
                </ul>
                
                <h2>Hard Banned Cards</h2>
                <div id="banned-list"></div>
                
                <h2>Legal Sets</h2>
                <div id="legal-sets-list" class="legal-sets"></div>
            </div>
        </div>
        
        <!-- Playlist Tab -->
        <div id="playlist" class="tab-content">
            <h1>Set Explorer</h1>
            <p>Browse cards from legal Magic: The Gathering sets to see which are playable in the Magic Gauntlet format.</p>
            
            <div class="set-selector">
                <label for="setSelect">Select a Set:</label>
                <select id="setSelect" onchange="loadSetCards()">
                    <option value="">-- Choose a Set --</option>
                </select>
            </div>
            
            <div id="set-info"></div>
            <div id="set-cards" class="card-gallery"></div>
        </div>
        
        <!-- Graveyard Tab -->
        <div id="graveyard" class="tab-content">
            <h1>Graveyard (Banned Cards)</h1>
            <div id="graveyard-cards" class="card-gallery"></div>
        </div>
    </div>

    <script>
        // SINGLE SOURCE OF TRUTH FOR BANNED CARDS
        const hardBannedCards = [
            "Sol Ring", "Lightning Bolt", "Mana Crypt", "Mox Emerald", 
            "Mox Jet", "Mox Pearl", "Mox Ruby", "Mox Sapphire", 
            "Murder", "Hero's Downfall", "Angel of Sanctions"
        ];

        // LEGAL SETS
        const legalSets = [
            "Adventures in the Forgotten Realms", "Aether Revolt", "Aetherdrift", "Alara Reborn", 
            "Alliances", "Amonkhet", "Antiquities", "Apocalypse", "Arabian Nights", 
            "Assassin's Creed", "Avacyn Restored", "Battle for Zendikar", 
            "Betrayers of Kamigawa", "Bloomburrow", "Born of the Gods", "Champions of Kamigawa", 
            "Coldsnap", "Conflux", "Core Set 2019", "Core Set 2020", "Core Set 2021", 
            "Dark Ascension", "Darksteel", "Dominaria", "Dominaria: United", 
            "Dragons of Tarkir", "Dragon's Maze", "Duskmourn: House of Horror", "Edge of Eternities", 
            "Eldritch Moon", "Eventide", "Exodus", "Fallen Empires", "Fate Reforged", 
            "Final Fantasy", "Fifth Dawn", "Future Sight", "Gatecrash", "Guilds of Ravnica", 
            "Homelands", "Hour of Devastation", "Ice Age", "Ikoria: Lair of Behemoths", 
            "Innistrad", "Innistrad: Crimson Vow", "Innistrad: Midnight Hunt", "Invasion", 
            "Ixalan", "Judgment", "Journey into Nyx", "Kaladesh", "Kaldheim", 
            "Kamigawa: Neon Dynasty", "Khans of Tarkir", "Legends", "Legions", 
            "Limited Edition Beta", "Lorwyn", "Magic 2010", "Magic 2011", "Magic 2012", 
            "Magic 2013", "Magic 2014", "Magic 2015", "Magic Origins", "March of the Machine", 
            "March of the Machine: The Aftermath", "Mercadian Masques", "Mirage", 
            "Mirrodin", "Mirrodin Besieged", "Morningtide", "MTG Lord of the Rings", 
            "Murders at Karlov Manor", "Nemesis", "New Phyrexia", "Oath of the Gatewatch", 
            "Odyssey", "Onslaught", "Outlaws of Thunder Junction", "Phyrexia: All Will Be One", 
            "Planechase", "Planar Chaos", "Planeshift", "Prophecy", "Ravnica Allegiance", 
            "Ravnica: City of Guilds", "Return to Ravnica", "Rise of the Eldrazi", 
            "Rivals of Ixalan", "Saviors of Kamigawa", "Scars of Mirrodin", "Scourge", 
            "Shadows over Innistrad", "Shadowmoor", "Shards of Alara", "Streets of New Capenna", 
            "Strixhaven: School of Mages", "Stronghold", "Tarkir: Dragonstorm", "Tempest", 
            "The Brothers' War", "The Dark", "The Lost Caverns of Ixalan", "Theros", 
            "Theros Beyond Death", "Throne of Eldraine", "Time Spiral", "Torment", 
            "Urza's Destiny", "Urza's Legacy", "Urza's Saga", "Visions", 
            "War of the Spark", "Weatherlight", "Wilds of Eldraine", "Worldwake", 
            "Zendikar", "Zendikar Rising"
        ];

        // TAB SYSTEM
        function openTab(event, tabName) {
            // Hide all tab contents
            const tabContents = document.getElementsByClassName("tab-content");
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove("active");
            }
            
            // Deactivate all tab buttons
            const tabButtons = document.getElementsByClassName("tab-btn");
            for (let i = 0; i < tabButtons.length; i++) {
                tabButtons[i].classList.remove("active");
            }
            
            // Activate selected tab
            document.getElementById(tabName).classList.add("active");
            event.currentTarget.classList.add("active");
            
            // If playlist tab is opened, populate set selector
            if (tabName === 'playlist') {
                populateSetSelector();
            }
        }

        // POPULATE SET SELECTOR
        function populateSetSelector() {
            const setSelect = document.getElementById("setSelect");
            // Clear existing options except the first one
            while (setSelect.options.length > 1) {
                setSelect.remove(1);
            }
            
            // Add legal sets to the dropdown
            legalSets.forEach(set => {
                const option = document.createElement("option");
                option.value = set;
                option.textContent = set;
                setSelect.appendChild(option);
            });
        }

        // LOAD CARDS FOR SELECTED SET
        async function loadSetCards() {
            const setName = document.getElementById("setSelect").value;
            if (!setName) return;
            
            const setInfo = document.getElementById("set-info");
            const setCards = document.getElementById("set-cards");
            
            setInfo.innerHTML = "<p>Loading cards...</p>";
            setCards.innerHTML = "";
            
            try {
                // Handle Limited Edition Beta specially
                let apiSetName = setName;
                if (setName === "Limited Edition Beta") {
                    apiSetName = "leb"; // Scryfall uses "leb" for Limited Edition Beta
                }
                
                // We need to use the Scryfall API to search for cards in the set
                const response = await fetch(`https://api.scryfall.com/cards/search?q=e:${encodeURIComponent(apiSetName.toLowerCase().replace(/[^a-z0-9]+/g, ''))}+order:set`);
                const data = await response.json();
                
                setInfo.innerHTML = `<h2>${setName} (${data.data.length} cards)</h2>`;
                
                // Display cards
                data.data.forEach(card => {
                    const banReason = isCardBanned(card);
                    const status = banReason ? "banned" : "legal";
                    
                    const cardElement = document.createElement("div");
                    cardElement.className = "card-item";
                    cardElement.innerHTML = `
                        <img src="${card.image_uris ? card.image_uris.normal : (card.card_faces ? card.card_faces[0].image_uris.normal : '')}" alt="${card.name}">
                        <div class="card-item-content">
                            <h3>${card.name}</h3>
                            <span class="card-status status-${status}">${status.toUpperCase()}</span>
                            ${banReason ? `<p class="card-rules-text">${banReason}</p>` : ''}
                        </div>
                    `;
                    
                    setCards.appendChild(cardElement);
                });
            } catch (error) {
                setInfo.innerHTML = `<p>Error loading set: ${error.message}. Note: Some custom sets may not be available in the API.</p>`;
                console.error("Error loading set:", error);
            }
        }

        // UPDATE GRAVEYARD DISPLAY
        function updateGraveyardDisplay() {
            const graveyard = document.getElementById("graveyard-cards");
            graveyard.innerHTML = hardBannedCards.map(card => `
                <div class="banned-card">
                    <h3>${card}</h3>
                </div>
            `).join("");
        }

        // UPDATE BANNED LIST IN GUIDELINES
        function updateBannedList() {
            const bannedList = document.getElementById("banned-list");
            bannedList.innerHTML = "<p>" + hardBannedCards.map(card => `"${card}"`).join(", ") + "</p>";
        }
        
        // UPDATE LEGAL SETS LIST IN GUIDELINES
        function updateLegalSetsList() {
            const legalSetsList = document.getElementById("legal-sets-list");
            legalSetsList.innerHTML = `<p><strong>${legalSets.length} Legal Sets:</strong></p>
                <div class="legal-sets-grid">
                    ${legalSets.map(set => `<div class="legal-set-item">${set}</div>`).join("")}
                </div>`;
        }

        // IMPROVED CARD CHECKER FUNCTIONS
        function isCardBanned(card) {
            // Check hard ban list first
            if (hardBannedCards.includes(card.name)) {
                return "Card is hard banned";
            }
            
            // Check if card is from a legal set
            // Handle Limited Edition Beta (Scryfall returns "Limited Edition Beta" as set_name)
            let cardSetName = card.set_name;
            if (cardSetName === "Limited Edition Beta") {
                cardSetName = "Limited Edition Beta";
            }
            
            if (cardSetName && !legalSets.includes(cardSetName)) {
                return "Card is from a non-legal set: " + cardSetName;
            }

            // Damage spell rules
            if (card.type_line.includes("Instant") || card.type_line.includes("Sorcery")) {
                if (card.oracle_text && card.oracle_text.toLowerCase().includes("damage")) {
                    const damageMatch = card.oracle_text.match(/deal[s]? (\d+) damage/i);
                    if (damageMatch) {
                        const damage = parseInt(damageMatch[1]);
                        const cmc = card.cmc;
                        if (damage > cmc) {
                            return "Damage spells cannot deal more damage than their CMC";
                        }
                    }
                }
                
                // Improved kill spell rules - now properly handles conditional removal
                if (card.oracle_text && card.oracle_text.toLowerCase().includes("destroy target")) {
                    // Check if it's conditional removal
                    const isConditional = (
                        card.oracle_text.toLowerCase().includes("with") ||
                        card.oracle_text.toLowerCase().includes("unless") ||
                        card.oracle_text.toLowerCase().includes("if") ||
                        card.oracle_text.toLowerCase().includes("non") ||
                        card.oracle_text.toLowerCase().includes("can't") ||
                        card.oracle_text.toLowerCase().includes("without") ||
                        card.oracle_text.toLowerCase().includes("equal") ||
                        card.oracle_text.toLowerCase().includes("less") ||
                        card.oracle_text.toLowerCase().includes("greater")
                    );
                    
                    // Unconditional removal must cost 5 or more
                    if (!isConditional && card.cmc < 5) {
                        return "Unconditional kill spells must cost 5 or more";
                    }
                }
                
                // Counter spell rules
                if (card.oracle_text && card.oracle_text.toLowerCase().includes("counter target")) {
                    // Check if it's conditional
                    const isConditional = (
                        card.oracle_text.toLowerCase().includes("unless") ||
                        card.oracle_text.toLowerCase().includes("if") ||
                        card.oracle_text.toLowerCase().includes("unless its controller pays") ||
                        card.oracle_text.toLowerCase().includes("that targets a")
                    );
                    
                    // Unconditional counters must cost 4 or more
                    if (!isConditional && card.cmc < 4) {
                        return "Unconditional counterspells must cost 4 or more";
                    }
                }
            }
            
            // Board wipe rules
            if (card.oracle_text && (card.oracle_text.toLowerCase().includes("destroy all") || 
                card.oracle_text.toLowerCase().includes("exile all")) &&
                card.cmc < 6) {
                return "Mass board wipes must cost 6 or more";
            }
            
            // Land destruction rules
            if (card.oracle_text && card.oracle_text.toLowerCase().includes("destroy target land") && 
                card.cmc < 4) {
                return "Land destruction spells must cost 4 or more";
            }
            
            // Land rules
            if (card.type_line.includes("Land")) {
                if (card.oracle_text && (card.oracle_text.toLowerCase().includes("enters the battlefield untapped") ||
                    card.oracle_text.toLowerCase().includes("add two or more mana"))) {
                    return "Dual lands must enter tapped and cannot have positive ETB effects";
                }
            }
            
            // Mana rock rules
            if (card.type_line.includes("Artifact")) {
                const oracleText = card.oracle_text ? card.oracle_text.toLowerCase() : "";
                
                if (oracleText.includes("add") && oracleText.includes("mana")) {
                    if (oracleText.match(/adds? \{.+\}.+and.+{.+}/) || 
                        oracleText.includes("two or more") ||
                        oracleText.includes("add an additional") ||
                        oracleText.match(/adds? \w+ mana/)) {
                        return "Mana rocks can only produce 1 mana";
                    }
                    
                    if (card.cmc < 3 && 
                        !oracleText.includes("enters the battlefield tapped") &&
                        !card.name.toLowerCase().includes("lotus")) {
                        return "Mana rocks under 3 CMC must enter tapped";
                    }
                }
            }
            
            return false;
        }

        async function checkCard() {
            const input = document.getElementById("searchInput").value.trim();
            const resultDiv = document.getElementById("result");
            const cardDisplay = document.getElementById("card-display");
            const cardImage = document.getElementById("card-image");
            const cardInfo = document.getElementById("card-info");
            
            if (!input) {
                resultDiv.textContent = "Please enter a card name";
                resultDiv.className = "";
                cardDisplay.style.display = "none";
                return;
            }

            try {
                const response = await fetch(`https://api.scryfall.com/cards/named?fuzzy=${encodeURIComponent(input)}`);
                const card = await response.json();
                
                cardImage.src = card.image_uris ? card.image_uris.normal : card.card_faces[0].image_uris.normal;
                cardInfo.innerHTML = `
                    <strong>${card.name}</strong><br>
                    <em>${card.type_line}</em><br>
                    ${card.oracle_text}<br>
                    <strong>Mana Cost:</strong> ${card.mana_cost} (CMC: ${card.cmc})<br>
                    <strong>Set:</strong> ${card.set_name}
                `;
                cardDisplay.style.display = "block";
                
                const banReason = isCardBanned(card);
                if (banReason) {
                    resultDiv.textContent = `BANNED: ${banReason}`;
                    resultDiv.className = "banned";
                } else {
                    resultDiv.textContent = "LEGAL in Magic Gauntlet";
                    resultDiv.className = "legal";
                }
            } catch (error) {
                resultDiv.textContent = "Card not found or error occurred";
                resultDiv.className = "";
                cardDisplay.style.display = "none";
                console.error("Error fetching card:", error);
            }
        }

        // INITIALIZE ON LOAD
        window.onload = function() {
            updateBannedList();
            updateGraveyardDisplay();
            updateLegalSetsList();
            populateSetSelector();
            
            // Enable Enter key in search
            document.getElementById("searchInput").addEventListener("keypress", function(event) {
                if (event.key === "Enter") {
                    checkCard();
                }
            });
        };
    </script>
</body>
            </html>
